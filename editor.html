
<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–†–µ–¥–∞–∫—Ç–æ—Ä Donator—ñ–≤</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: auto; padding: 2rem; }
    input, select { margin-bottom: 1rem; width: 100%; padding: 0.5rem; }
    button { padding: 0.5rem 1rem; margin-right: 1rem; }
    #output, #preview { white-space: pre; background: #f9f9f9; padding: 1rem; margin-top: 1rem; border: 1px solid #ccc; }
    ul { padding-left: 1rem; }
    li { margin-bottom: 4px; }
    .edit-btn, .delete-btn { margin-left: 10px; cursor: pointer; }
    .edit-btn:hover, .delete-btn:hover { text-decoration: underline; }
    #sum { margin-top: 1rem; font-weight: bold; }
  </style>
</head>
<body>
  <h1>–†–µ–¥–∞–∫—Ç–æ—Ä Donator—ñ–≤</h1>

  <label>–Ü–º‚Äô—è:</label>
  <input type="text" id="name" />

  <label>–°—É–º–∞ –¥–æ–Ω–∞—Ç—É (–≥—Ä–Ω):</label>
  <input type="number" id="amount" />

  <button onclick="addOrUpdate()">–î–æ–¥–∞—Ç–∏ –¥–æ–Ω–∞—Ç–æ—Ä–∞</button>
  <button onclick="downloadJSON()">–ó–±–µ—Ä–µ–≥—Ç–∏ JSON</button>
  <button onclick="clearAll()">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ</button>
  <input type="file" id="fileInput" onchange="importJSON()" />

  <div id="preview"></div>
  <div id="sum"></div>
  <div id="output"></div>

  <script>
    const palette = ["#4CAF50", "#2196F3", "#FF9800", "#E91E63", "#9C27B0", "#00BCD4", "#FFC107", "#8BC34A", "#673AB7", "#795548", "#607D8B", "#F44336", "#3F51B5", "#CDDC39", "#009688", "#FF5722", "#9E9E9E", "#03A9F4", "#C2185B", "#7B1FA2", "#0288D1", "#388E3C", "#F57C00", "#5D4037", "#689F38", "#1976D2", "#D32F2F", "#512DA8", "#00796B", "#FFA000"];
    let usedColors = [];

    function getNextColor() {
      if (usedColors.length >= palette.length) {
        usedColors = [];
      }
      let available = palette.filter(c => !usedColors.includes(c));
      let color = available[Math.floor(Math.random() * available.length)];
      usedColors.push(color);
      return color;
    }

    let puzzles = [];
    let thanks = [];
    let counter = 1;
    let editIndex = -1;

    function padNumber(num) {
      return num.toString().padStart(2, '0');
    }

    function addOrUpdate() {
      const name = document.getElementById("name").value.trim();
      const amount = parseFloat(document.getElementById("amount").value);
      let color = getNextColor();

      if (!name || isNaN(amount)) {
        alert("–í–≤–µ–¥–∏ —ñ–º‚Äô—è —Ç–∞ —Å—É–º—É!");
        return;
      }

      if (editIndex !== -1) {
        if (amount >= 2500) {
          puzzles[editIndex] = { ...puzzles[editIndex], name, color };
        } else {
          thanks.push(name);
          puzzles.splice(editIndex, 1);
        }
        editIndex = -1;
      } else {
        if (amount >= 2500) {
          puzzles.push({
            id: 'puzzle-' + padNumber(counter),
            name: name,
            color: color
          });
          counter++;
        } else {
          thanks.push(name);
        }
      }

      clearForm();
      showPreview();
      showOutput();
    }

    function clearForm() {
      document.getElementById("name").value = "";
      document.getElementById("amount").value = "";
      editIndex = -1;
    }

    function showPreview() {
      const list = [];

      list.push("<strong>–ü–∞–∑–ª–∏:</strong>");
      puzzles.forEach(function(p, i) {
        list.push('<li>' +
          p.name + ' (ID: ' + p.id + ', –∫–æ–ª—ñ—Ä: ' + p.color + ')' +
          '<span class="edit-btn" onclick="edit(' + i + ')">‚úèÔ∏è</span>' +
          '<span class="delete-btn" onclick="remove(' + i + ')">üóëÔ∏è</span>' +
          '</li>');
      });

      list.push("<br><strong>–ü–æ–¥—è–∫–∏ (<2500):</strong>");
      thanks.forEach(function(name, i) {
        list.push('<li>' +
          name +
          '<span class="delete-btn" onclick="removeThank(' + i + ')">üóëÔ∏è</span>' +
          '</li>');
      });

      document.getElementById("preview").innerHTML = "<ul>" + list.join("") + "</ul>";

      const sum = puzzles.length * 2500 + thanks.length * 2499;
      document.getElementById("sum").textContent = "–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –¥–æ–Ω–∞—Ç—ñ–≤: " + sum.toLocaleString() + " –≥—Ä–Ω";
    }

    function remove(index) {
      puzzles.splice(index, 1);
      showPreview();
      showOutput();
    }

    function removeThank(index) {
      thanks.splice(index, 1);
      showPreview();
      showOutput();
    }

    function edit(index) {
      const item = puzzles[index];
      document.getElementById("name").value = item.name;
      document.getElementById("amount").value = "2500";
      editIndex = index;
    }

    function showOutput() {
      const data = {
        puzzles,
        thanks
      };
      document.getElementById("output").textContent = JSON.stringify(data, null, 2);
    }

    function downloadJSON() {
      const data = {
        puzzles,
        thanks
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = "data.json";
      link.click();
    }

    function clearAll() {
      if (confirm("–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ?")) {
        puzzles = [];
        thanks = [];
        counter = 1;
        showPreview();
        showOutput();
      }
    }

    function importJSON() {
      const file = document.getElementById("fileInput").files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const json = JSON.parse(e.target.result);
        puzzles = json.puzzles || [];
        thanks = json.thanks || [];
        counter = puzzles.length + 1;
        showPreview();
        showOutput();
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
